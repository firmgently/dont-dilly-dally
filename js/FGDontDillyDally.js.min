var uk=(uk!==undefined)?uk:{};uk.co=(uk.co!==undefined)?uk.co:{};uk.co.firmgently=(uk.co.firmgently!==undefined)?uk.co.firmgently:{};uk.co.firmgently.DDDConsts=(function(){"use strict";var CONST={APP_ID:"FGDDD",SAVE_FILENAME:"DontDillyDally-export",COLORPICKER_CHANGEEVENT_ID:"colorpickerchange",COLORPICKER_CONFIRMEVENT_ID:"colorpickerconfirm",AUTOREPEAT_RATE:500,PAGETYPE_TIMESHEETS:"timesheets",PAGETYPE_CONFIG:"preferences",PAGETYPE_JOBSANDCLIENTS:"jobs-and-clients",BODYID_TIMESHEETS:"timesheets",BODYID_CONFIG:"config",BODYID_JOBSANDCLIENTS:"jobsClients",MONTH_NAMES:["January","February","March","April","May","June","July","August","September","October","November","December"],GUITYPE_PARA:"GUITypePara",GUITYPE_COL:"GUITypeCol",GUITYPE_ROW:"GUITypeRow",GUITYPE_BTN:"GUITypeBtn",GUITYPE_COLORPICKER:"GUITypeColorPicker",GUITYPE_RADIOBTN:"GUITypeRadioBtn",GUITYPE_TEXTINPUT:"GUITypeTextInput",GUITYPE_SELECT:"GUITypeSelect",GUITYPE_FORM:"GUITypeForm",GUITYPE_SECTION:"GUITypeSection",GUITYPE_METHODCALL:"GUITypeMethodCall",GUITYPE_UL:"GUITypeUL",CLASS_BTNNAV:"btnNav",CLASS_BTNMININAV:"btnMiniNav",CLASS_FORMMAIN:"formMain",CLASS_COL:"col",CLASS_ROW:"row",CLASS_CLIENTSELECT:"select-client",CLASS_JOBSELECT:"select-job",CLASS_TODAY:"today",TOTAL_STR:"Total",DAY_STR:"day",CLIENT_STR:"client",JOB_STR:"job",DAYS_STR:"days",CLIENTS_STR:"clients",JOBS_STR:"jobs",PREFS_STR:"prefs",CLIENTSTOTAL_STR:"clientsTotal",JOBSTOTAL_STR:"jobsTotal",CLIENT_SELECT_PLACEHOLDER:"select client",JOB_SELECT_PLACEHOLDER:"select job",JOBNOTES_PLACEHOLDER:"job notes",MONEYNOTES_PLACEHOLDER:"money notes",SEPARATOR_CASH:".",SEPARATOR_TIME:":",TODAY_STR:"today",EL_ID_COLHEADING:"column-headings",EL_ID_JOBNAMEIN:"jobNameIn",EL_ID_CLIENTNAMEIN:"clientNameIn",EL_ID_CLIENTSAVEBTN:"saveNewClientBtn",EL_ID_JOBSAVEBTN:"saveNewJobBtn",EL_ID_SELECTCLIENT:"selectClient",EL_ID_SELECTJOB:"selectJob",CLIENT_FG_COLPICK:"clientFGPicker",CLIENT_BG_COLPICK:"clientBGPicker",JOB_FG_COLPICK:"jobFGPicker",JOB_BG_COLPICK:"jobBGPicker",DATATYPE_JOB:"dataTypeJob",DATATYPE_CLIENT:"dataTypeClient",ITEMTYPE_TIME:"TIME",ITEMTYPE_MONEY:"CASH",DATAINDICES:{itemType:0,numberValue:1,clientID:2,jobID:3,notes:4},CONTENTTYPE_CLIENTS:"contentTypeClients",CONTENTTYPE_JOBS:"contentTypeJobs",TIMESHEETCONTAINER_ID:"timesheetContainer",LOADINGINDICATOR_ID:"loading-indicator",PAGEDATA_JOBSANDCLIENTS:{pageTitle:"Jobs and Clients",intro:"Add, delete or edit jobs and clients. Click the squares to edit colours."},PAGEDATA_TIMESHEETS:{pageTitle:"Timesheets",intro:"Keep track of where you spend your time. Also record payments in and expenses paid out."},PAGEDATA_CONFIG:{pageTitle:"Preferences",intro:"Show and hide things and customise settings."},DATETYPE_YYMMDD:{label:"yy/mm/dd"},DATETYPE_DDMMYY:{label:"dd/mm/yy"},DATETYPE_MMDDYY:{label:"mm/dd/yy"},JOB_DEFAULTS:[{name:"Purchasing",color:"#000",bgcolor:"#0ff"},{name:"Administration",color:"#0f0",bgcolor:"#123"},{name:"Design",color:"#0ff",bgcolor:"#111"}],CLIENT_DEFAULTS:[{name:"ACME CO",color:"#fff",bgcolor:"#f00"},{name:"General Corp.",color:"#435",bgcolor:"#89a"}],TIMESPAN_WEEK:"timespanWeek",TIMESPAN_MONTH:"timespanMonth",TIMESPAN_YEAR:"timespanYear",DAYSINWEEK:7,DAYSINMONTH:31,DAYSINYEAR:365,SHOWTOTALS_WEEK:"showTotalsWeek",SHOWTOTALS_MONTH:"showTotalsMonth",SHOWTOTALS_BOTH:"showTotalsWeekAndMonth",MINUTEINCREMENTS_1:"minuteIncrement1",MINUTEINCREMENTS_15:"minuteIncrement15",MINUTEINCREMENTS_30:"minuteIncrement30",TXT_STORAGE_UNSUPPORTED:"Sorry - storage is not supported on this device or browser"};CONST.MINUTEINCREMENTS_DEFAULT=CONST.MINUTEINCREMENTS_15;CONST.SHOWTOTALS_DEFAULT=CONST.SHOWTOTALS_BOTH;CONST.TIMESPAN_DEFAULT=CONST.TIMESPAN_MONTH;CONST.DATETYPE_DEFAULT=CONST.DATETYPE_DDMMYY;CONST.PAGETYPE_DEFAULT=CONST.PAGETYPE_TIMESHEETS;CONST.GUIDATA_JOBSANDCLIENTS=[{type:CONST.GUITYPE_COL,id:"editClientCol",class:CONST.CLASS_COL,parent:"main",},{type:CONST.GUITYPE_FORM,id:"createClientForm",class:CONST.CLASS_FORMMAIN,title:"Clients",parent:"editClientCol",el_ar:[{type:CONST.GUITYPE_ROW,id:"clientsExistingRow",class:CONST.CLASS_ROW,parent:"createClientForm",}]},{type:CONST.GUITYPE_COL,id:"editJobCol",class:CONST.CLASS_COL,parent:"main",},{type:CONST.GUITYPE_FORM,id:"createJobForm",class:CONST.CLASS_FORMMAIN,title:"Jobs",parent:"editJobCol",hidden:false,el_ar:[{type:CONST.GUITYPE_ROW,id:"jobsExistingRow",class:CONST.CLASS_ROW,parent:"createJobForm",}]},{type:CONST.GUITYPE_METHODCALL,methodPathStr:"uk.co.firmgently.DontDillyDally.drawJobsAndClients",scopeID:"main"}];CONST.GUIDATA_NAVMAIN=[{type:CONST.GUITYPE_BTN,class:CONST.CLASS_BTNNAV,id:CONST.BODYID_JOBSANDCLIENTS,label:"Jobs & Clients",methodPathStr:"uk.co.firmgently.DontDillyDally.navClick",args:[CONST.PAGETYPE_JOBSANDCLIENTS],scopeID:"main",parent:"nav-main"},{type:CONST.GUITYPE_BTN,class:CONST.CLASS_BTNNAV,id:CONST.BODYID_CONFIG,label:"Preferences",methodPathStr:"uk.co.firmgently.DontDillyDally.navClick",args:[CONST.PAGETYPE_CONFIG],scopeID:"main",parent:"nav-main"},{type:CONST.GUITYPE_BTN,class:CONST.CLASS_BTNNAV,id:CONST.BODYID_TIMESHEETS,label:"Timesheets",methodPathStr:"uk.co.firmgently.DontDillyDally.navClick",args:[CONST.PAGETYPE_TIMESHEETS],scopeID:"main",parent:"nav-main"}];CONST.GUIDATA_TIMESHEETS=[{type:CONST.GUITYPE_FORM,id:"miniNavForm",parent:"main",el_ar:[{type:CONST.GUITYPE_PARA,text:"month",parent:"miniNavForm"},{type:CONST.GUITYPE_BTN,class:CONST.CLASS_BTNMININAV,label:"&#x25B2;",methodPathStr:"uk.co.firmgently.DontDillyDally.monthPrevClick",parent:"miniNavForm"},{type:CONST.GUITYPE_BTN,class:CONST.CLASS_BTNMININAV,label:"&#x25BC;",methodPathStr:"uk.co.firmgently.DontDillyDally.monthNextClick",parent:"miniNavForm"},{type:CONST.GUITYPE_PARA,text:"week",parent:"miniNavForm"},{type:CONST.GUITYPE_BTN,class:CONST.CLASS_BTNMININAV,label:"&#x25B2;",methodPathStr:"uk.co.firmgently.DontDillyDally.weekPrevClick",parent:"miniNavForm"},{type:CONST.GUITYPE_BTN,class:CONST.CLASS_BTNMININAV,label:"&#x25BC;",methodPathStr:"uk.co.firmgently.DontDillyDally.weekNextClick",parent:"miniNavForm"},{type:CONST.GUITYPE_BTN,class:CONST.CLASS_BTNMININAV,label:"today",methodPathStr:"uk.co.firmgently.DontDillyDally.todayClick",parent:"miniNavForm"}]},{type:CONST.GUITYPE_UL,id:CONST.TIMESHEETCONTAINER_ID,parent:"main"},{type:CONST.GUITYPE_METHODCALL,methodPathStr:"uk.co.firmgently.DontDillyDally.drawTimesheets",scopeID:"main"}];CONST.GUIDATA_CONFIG=[{type:CONST.GUITYPE_FORM,id:"configForm",class:CONST.CLASS_FORMMAIN,title:"Set your preferences here",parent:"main",hidden:false,el_ar:[{type:CONST.GUITYPE_RADIOBTN,id:"dateFormat",label:"Format used to show dates",parent:"configForm",options:{DATETYPE_DDMMYY:"dd/mm/yy",DATETYPE_MMDDYY:"mm/dd/yy",DATETYPE_YYMMDD:"yy/mm/dd"},disabled:true},{type:CONST.GUITYPE_RADIOBTN,id:"timespan",label:"Choose how many days you want to show on the timesheet page",parent:"configForm",options:{timespanWeek:"A week",timespanMonth:"A month",timespanYear:"A year"},disabled:true},{type:CONST.GUITYPE_RADIOBTN,id:"totalsToShow",label:"Choose which totals you want totted up and displayed",parent:"configForm",options:{showTotalsWeek:"Show weekly totals",showTotalsMonth:"Show monthly totals",showTotalsWeekAndMonth:"Show both weekly and monthly totals"},disabled:true},{type:CONST.GUITYPE_RADIOBTN,id:"minuteIncrements",label:"The shortest length of a time entry",parent:"configForm",options:{minuteIncrement1:"1 minute",minuteIncrement15:"15 minutes",minuteIncrement30:"30 minutes"},disabled:true}]},];return CONST;}());var uk=(uk!==undefined)?uk:{};uk.co=(uk.co!==undefined)?uk.co:{};uk.co.firmgently=(uk.co.firmgently!==undefined)?uk.co.firmgently:{};uk.co.firmgently.FGUtils=(function(){"use strict";var
addCSSRule,getIEVersion,isTouchDevice,registerEventHandler,unregisterEventHandler,stopPropagation,hexOpacityToRGBA,rgbToHex,getRandomHexColor,createElementWithId,removeClassname,addClassname,getStyle,padString,treatAsUTC,daysBetween,getFormattedDate,getFunctionFromString,getGUID,changeSelectByOption,manualEvent,updateSelectOptionList,isEmpty,logMsg;String.prototype.isEmpty=function(){return(!this||/^\s*$/.test(this));};Storage.prototype.setObject=function(key,value){this.setItem(key,JSON.stringify(value));};Storage.prototype.getObject=function(key){var value=this.getItem(key);return value&&JSON.parse(value);};Date.prototype.monthDays=function(){var d=new Date(this.getFullYear(),this.getMonth()+1,0);return d.getDate();};Date.prototype.isLeapYear=function(){var year=this.getFullYear();if((year&3)!==0){return false;}
return((year%100)!==0||(year%400)===0);};Date.prototype.getDOY=function(){var dayCount=[0,31,59,90,120,151,181,212,243,273,304,334],mn=this.getMonth(),dn=this.getDate(),dayOfYear=dayCount[mn]+dn;if(mn>1&&this.isLeapYear()){dayOfYear++};return dayOfYear;};Date.prototype.getShortISO=function(){return this.toISOString().substring(0,10)};Date.prototype.getWeekDay=function(length){var ret,weekday=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];ret=weekday[this.getDay()];if(length>0){ret=ret.substring(0,length);}
return ret;};Date.prototype.getWeekNumber=function(){var yearStart,d=new Date(Date.UTC(this.getFullYear(),this.getMonth(),this.getDate())),dayNum=d.getUTCDay()||7;d.setUTCDate(d.getUTCDate()+4-dayNum);yearStart=new Date(Date.UTC(d.getUTCFullYear(),0,1));return Math.ceil((((d-yearStart)/86400000)+1)/7)};stopPropagation=function(e){if(e.preventDefault){e.preventDefault();}
if(e.stopPropagation){e.stopPropagation();}
e.cancelBubble=true;e.returnValue=false;return false;};registerEventHandler=function(node,event,handler,useCapture){useCapture=(useCapture===undefined)?false:useCapture;if(typeof node.addEventListener==="function"){node.addEventListener(event,handler,useCapture);}else{node.attachEvent("on"+event,handler);}};unregisterEventHandler=function(node,event,handler,useCapture){useCapture=(useCapture===undefined)?false:useCapture;if(typeof node.removeEventListener==="function"){node.removeEventListener(event,handler,useCapture);}else{node.detachEvent("on"+event,handler);}};rgbToHex=function(r,g,b){return((r<<16)|(g<<8)|b).toString(16);};hexOpacityToRGBA=function(hexColour,opacity){var r,g,b;r=parseInt(hexColour.substring(0,2),16);g=parseInt(hexColour.substring(2,4),16);b=parseInt(hexColour.substring(4,6),16);return "rgba("+r+", "+g+", "+b+", "+opacity+")";};getRandomHexColor=function(tone){var full=16777215,third=5592405,smalln=1864135,hexString;if(tone===undefined){hexString='#'+Math.floor(Math.random()*full).toString(16);}else if(tone.toUpperCase()==="LIGHT"){hexString='#'+Math.floor(full-Math.random()*third).toString(16);}else if(tone.toUpperCase()==="DARK"){hexString='#'+Math.floor(Math.random()*smalln).toString(16);}
return hexString;};createElementWithId=function(elType,id){var el=document.createElement(elType);el.id=id;return el;};removeClassname=function(element,name){element.className=element.className.replace(" "+name,"");};addClassname=function(element,name){name=" "+name;element.className=element.className.replace(name,"");element.className=element.className+name;};addCSSRule=function(selector,property,newValue){var
i,curStyleSheet,totalStyleSheets=document.styleSheets.length,newStyle=property+": "+newValue;for(i=0;i<totalStyleSheets;i++){curStyleSheet=document.styleSheets[i];try{curStyleSheet.insertRule(selector+" {"+newStyle+"}",curStyleSheet.cssRules.length);}catch(err1){try{curStyleSheet.addRule(selector,newStyle);}catch(err2){}}}};padString=function(str,pad){var return_str=str;if(str.length<pad.length){return_str=pad.substr(0,(pad.length-str.length))+str;}
return return_str;};getFunctionFromString=function(str){var
i,scope=window,chain_ar=str.split('.'),chainLength=chain_ar.length-1;for(i=0;i<chainLength;i++){scope=scope[chain_ar[i]];if(scope===undefined){return;}}
return scope[chain_ar[chainLength]];};getFormattedDate=function(date,format){format=format.replace("yy",date.getUTCFullYear().toString().substr(-2));format=format.replace("dd",("0"+(date.getUTCDate())).slice(-2));format=format.replace("mm",("0"+(date.getUTCMonth()+1)).slice(-2));return format;};getStyle=function(el,styleProp){var style;if(el.currentStyle){style=el.currentStyle[styleProp];}else if(window.getComputedStyle){style=document.defaultView.getComputedStyle(el,null).getPropertyValue(styleProp);}
return style;};logMsg=function(msg){console.log(msg);};isEmpty=function(obj){var prop;for(prop in obj){if(obj.hasOwnProperty(prop)){return false;}}
return JSON.stringify(obj)===JSON.stringify({});};getIEVersion=function(){var undef,v=3,div=document.createElement('div'),all=div.getElementsByTagName('i');while(div.innerHTML='<!--[if gt IE '+(++v)+']><i></i><![endif]-->',all[0]);return v>4?v:undef;};isTouchDevice=function(){return(('ontouchstart'in window)||(navigator.MaxTouchPoints>0)||(navigator.msMaxTouchPoints>0));};treatAsUTC=function(date){var result=new Date(date);result.setMinutes(result.getMinutes()-result.getTimezoneOffset());return result;};daysBetween=function(startDate,endDate){var msPerDay=24*60*60*1000;return(treatAsUTC(endDate)-treatAsUTC(startDate))/msPerDay;};getGUID=function(){var d=new Date().getTime();if(typeof performance!=='undefined'&&typeof performance.now==='function'){d+=performance.now();}
return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c==='x'?r:(r&0x3|0x8)).toString(16);});};updateSelectOptionList=function(el,optionsData){var option,option_el;while(el.options.length){el.options.remove(el.options.length-1);}
for(option in optionsData){option_el=el.options[el.options.length]=new Option(optionsData[option].name,optionsData[option].class);addClassname(option_el,optionsData[option].class);}};changeSelectByOption=function(el,option){var i,options=el.options;for(i=0;i<options.length;i++){if(options[i].value===option){el.selectedIndex=i;break;}}};manualEvent=function(el,eventName){var evt;if("createEvent"in document){evt=document.createEvent("HTMLEvents");evt.initEvent(eventName,false,true);el.dispatchEvent(evt);}else{el.fireEvent("on"+eventName);}};return{registerEventHandler:registerEventHandler,unregisterEventHandler:unregisterEventHandler,stopPropagation:stopPropagation,removeClassname:removeClassname,addClassname:addClassname,addCSSRule:addCSSRule,hexOpacityToRGBA:hexOpacityToRGBA,rgbToHex:rgbToHex,getRandomHexColor:getRandomHexColor,createElementWithId:createElementWithId,getFunctionFromString:getFunctionFromString,getFormattedDate:getFormattedDate,treatAsUTC:treatAsUTC,padString:padString,daysBetween:daysBetween,logMsg:logMsg,isEmpty:isEmpty,getIEVersion:getIEVersion,getStyle:getStyle,isTouchDevice:isTouchDevice,changeSelectByOption:changeSelectByOption,updateSelectOptionList:updateSelectOptionList,manualEvent:manualEvent,getGUID:getGUID};}());var uk=(uk!==undefined)?uk:{};uk.co=(uk.co!==undefined)?uk.co:{};uk.co.firmgently=(uk.co.firmgently!==undefined)?uk.co.firmgently:{};uk.co.firmgently.FGHTMLBuild=(function(){"use strict";var
SPINNER_REPEAT_RATE=250,SPINNER_REPEAT_ACCEL=1.04,SPINNER_CLASSNAME="spinner",SPINNER_UPBTN_CLASSNAME="spin-button-up",SPINNER_DOWNBTN_CLASSNAME="spin-button-down",COLORPICKER_IMG_ID="color-picker-img",COLORPICKER_CANVAS_ID="color-picker-canvas",COLORPICKER_IMG_PATH="/images/wheel.png",fillHTMLFromOb,createButtonFromOb,createRadioFromOb,createCheckboxFromOb,createInputFromOb,createSpinnerFromOb,createSelectFromOb,createFormFromOb,addLIsFromOb,createBasicElementFromOb,createColorPickerFromOb,onSpinnerStart,onSpinnerMouseUp,doSpinStep,spinnerTimer,onIncreaseSpinnerMouseDown,onDecreaseSpinnerMouseDown,onColorPickerClick,onColorPickerCanvasClick,onColorPickerCanvasMoveOver,onColorPickerImageLoad,colorPickerImage,colorPickerCanvas,colorPickerSelectedCurrent;fillHTMLFromOb=function(ob){for(var prop in ob){if(document.getElementById(prop)){document.getElementById(prop).innerHTML=ob[prop];}}};createButtonFromOb=function(ob){var
button_el,parent_el=(typeof ob.parent=="string")?document.getElementById(ob.parent):ob.parent;if(ob.id){button_el=createElementWithId("button",ob.id);}else{button_el=document.createElement("button");}
parent_el.appendChild(button_el);if(ob.class){addClassname(button_el,ob.class);}
button_el.innerHTML=ob.label;button_el.ob=ob;if(ob.disabled){button_el.disabled=ob.disabled;}
return button_el;};createInputFromOb=function(ob){var
prop,input_el,label_el,innerHTML="",parent_el=(typeof ob.parent=="string")?document.getElementById(ob.parent):ob.parent;if(ob.id){if(ob.label){label_el=document.createElement("label");label_el.innerHTML=ob.label;parent_el.appendChild(label_el);label_el.htmlFor=ob.id;}
input_el=createElementWithId("input",ob.id);input_el.name=ob.id;}else{input_el=document.createElement("input");}
if(ob.class){addClassname(input_el,ob.class);}
parent_el.appendChild(input_el);if(ob.attributes){for(prop in ob.attributes){input_el.setAttribute(""+prop,""+ob.attributes[prop]);}}
input_el.ob=ob;return input_el;};createSpinnerFromOb=function(ob){var
prop,input_el,label_el,up_el,down_el,innerHTML="",wrapper_el=document.createElement("div"),parent_el=(typeof ob.parent=="string")?document.getElementById(ob.parent):ob.parent;parent_el.appendChild(wrapper_el);input_el=document.createElement("input");if(ob.class){addClassname(input_el,ob.class);}
addClassname(wrapper_el,SPINNER_CLASSNAME);wrapper_el.appendChild(input_el);input_el.ob=ob;input_el.spin_ob={};for(prop in ob.attributes){input_el.spin_ob[prop]=ob.attributes[prop];}
up_el=document.createElement("button");up_el.innerHTML="&#x25B2;";up_el.spinner=input_el;addClassname(up_el,SPINNER_UPBTN_CLASSNAME);wrapper_el.appendChild(up_el);registerEventHandler(up_el,"mousedown",onIncreaseSpinnerMouseDown);registerEventHandler(up_el,"mouseup",onSpinnerMouseUp);registerEventHandler(up_el,"mouseout",onSpinnerMouseUp);down_el=document.createElement("button");down_el.innerHTML="&#x25BC;";down_el.spinner=input_el;addClassname(down_el,SPINNER_DOWNBTN_CLASSNAME);wrapper_el.appendChild(down_el);registerEventHandler(down_el,"mousedown",onDecreaseSpinnerMouseDown);registerEventHandler(down_el,"mouseup",onSpinnerMouseUp);registerEventHandler(down_el,"mouseout",onSpinnerMouseUp);return input_el;};onIncreaseSpinnerMouseDown=function(){onSpinnerStart(this.spinner,1);};onDecreaseSpinnerMouseDown=function(){onSpinnerStart(this.spinner,-1);};onSpinnerStart=function(spinner,dir){spinner.isChanging=true;spinner.curRepeatRate=SPINNER_REPEAT_RATE;doSpinStep(spinner,dir);};onSpinnerMouseUp=function(){this.spinner.isChanging=false;clearTimeout(spinnerTimer);};doSpinStep=function(spinner,dir){var valNew=parseInt(spinner.value)+(parseInt(spinner.spin_ob.step)*dir);if(isNaN(valNew)){valNew=0;}
if(valNew<spinner.spin_ob.min){if(spinner.spin_ob.wrapNum){valNew=spinner.spin_ob.max;}else{valNew=spinner.spin_ob.min;}}else if(valNew>spinner.spin_ob.max){if(spinner.spin_ob.wrapNum){valNew=spinner.spin_ob.min;}else{valNew=spinner.spin_ob.max;}}
spinner.value=valNew;manualEvent(spinner,"change");clearTimeout(spinnerTimer);if(spinner.isChanging){spinner.curRepeatRate/=SPINNER_REPEAT_ACCEL;spinnerTimer=setTimeout(doSpinStep,spinner.curRepeatRate,spinner,dir);}};createSelectFromOb=function(ob){var i,prop,select_el,label_el,option_el,clientOrJob_ob,dayPrefix,placeholderOption,parent_el=(typeof ob.parent=="string")?document.getElementById(ob.parent):ob.parent;if(ob.id){if(ob.label){label_el=document.createElement("label");label_el.innerHTML=ob.label;parent_el.appendChild(label_el);label_el.htmlFor=ob.id;}
select_el=createElementWithId("select",ob.id);select_el.name=ob.id;select_el.id=ob.id;}else{select_el=document.createElement("select");}
if(ob.class){addClassname(select_el,ob.class);}
parent_el.appendChild(select_el);select_el.setAttribute("size","1");if(ob.placeholderText){placeholderOption=new Option(ob.placeholderText,"");placeholderOption.disabled=true;placeholderOption.selected=true;placeholderOption.hidden=true;select_el.options[select_el.options.length]=placeholderOption;}
if(ob.contentType){if(ob.contentType===CONTENTTYPE_CLIENTS){addClassname(select_el,CLASS_CLIENTSELECT);}else if(ob.contentType===CONTENTTYPE_JOBS){addClassname(select_el,CLASS_JOBSELECT);}
for(prop in ob.options){clientOrJob_ob=ob.options[prop];option_el=select_el.options[select_el.options.length]=new Option(clientOrJob_ob.name,clientOrJob_ob.class);addClassname(option_el,clientOrJob_ob.class);}}else{for(prop in ob.options){select_el.options[select_el.options.length]=new Option(ob.options[prop],prop);}}
select_el.ob=ob;return select_el;};createCheckboxFromOb=function(ob){var
prop,checkbox_el,label_el,div_el,parent_el=(typeof ob.parent=="string")?document.getElementById(ob.parent):ob.parent;if(ob.label){label_el=document.createElement("label");label_el.innerHTML=ob.label;parent_el.appendChild(label_el);}
if(ob.id){checkbox_el.id=ob.id;checkbox_el.name=ob.id;if(ob.label){label_el.htmlFor=ob.id;}}
checkbox_el=document.createElement("input");if(ob.class){addClassname(checkbox_el,ob.class);}
checkbox_el.setAttribute("type","checkbox");checkbox_el.ob=ob;checkbox_el.checked=ob.checked;if(ob.wrapLabel){label_el.appendChild(checkbox_el);if(ob.addDivToLabel){div_el=document.createElement("div");label_el.appendChild(div_el);}}else{parent_el.appendChild(checkbox_el);}
return checkbox_el;};createRadioFromOb=function(ob){var
prop,description_el,radio_el,label_el,parent_el=(typeof ob.parent=="string")?document.getElementById(ob.parent):ob.parent;if(ob.label){description_el=document.createElement("p");description_el.innerHTML=ob.label;parent_el.appendChild(description_el);}
for(prop in ob.options){label_el=document.createElement("label");label_el.innerHTML=ob.options[prop];parent_el.appendChild(label_el);radio_el=document.createElement("input");if(ob.class){addClassname(radio_el,ob.class);}
parent_el.appendChild(radio_el);radio_el.setAttribute("type","radio");radio_el.id=ob.id;radio_el.name=ob.id;radio_el.value=prop;if(prop===ob.checkIfMatched){radio_el.checked=true;}
label_el.htmlFor=ob.id;}
return radio_el;};addLIsFromOb=function(ob){var
i,li_el,UL_el,parent_el=(typeof ob.parent=="string")?document.getElementById(ob.parent):ob.parent;if(ob.id){UL_el=createElementWithId("ul",ob.id)}else{UL_el=document.createElement("ul");}
addClassname(UL_el,CLASS_ROW);if(ob.ar){for(i=0;i<ob.ar.length;i++){li_el=document.createElement("li");li_el.innerHTML=ob.ar[i];UL_el.appendChild(li_el);if(ob.class){addClassname(li_el,ob.class);}}}
parent_el.appendChild(UL_el);};createBasicElementFromOb=function(ob){var
el,elType,parent_el=(typeof ob.parent=="string")?document.getElementById(ob.parent):ob.parent;switch(ob.type){case GUITYPE_COL:case GUITYPE_ROW:elType="span";break;case GUITYPE_PARA:elType="p";break;case GUITYPE_SECTION:elType="section";break;default:elType="div";break;}
if(ob.id){el=createElementWithId(elType,ob.id);}else{el=document.createElement(elType);}
parent_el.appendChild(el);if(ob.class){addClassname(el,ob.class);}
if(ob.text){el.innerHTML=ob.text;}
return el;};createColorPickerFromOb=function(ob){var
el,label_el,parent_el=(typeof ob.parent=="string")?document.getElementById(ob.parent):ob.parent;el=createElementWithId("input",ob.id);el.type="checkbox";parent_el.appendChild(el);if(ob.class){addClassname(el,ob.class);}
label_el=document.createElement("label");label_el.htmlFor=ob.id;label_el.style.backgroundColor=ob.color;parent_el.appendChild(label_el);if(!colorPickerImage){colorPickerImage=createElementWithId("img",COLORPICKER_IMG_ID);colorPickerImage.src=COLORPICKER_IMG_PATH;registerEventHandler(colorPickerImage,"load",onColorPickerImageLoad);}
label_el.colorPickerCanvas=colorPickerCanvas;registerEventHandler(label_el,"click",onColorPickerClick);return el;};onColorPickerImageLoad=function(){colorPickerCanvas=createElementWithId("canvas",COLORPICKER_CANVAS_ID);colorPickerCanvas.width=colorPickerImage.width;colorPickerCanvas.height=colorPickerImage.height;colorPickerCanvas.getContext('2d').drawImage(colorPickerImage,0,0,colorPickerImage.width,colorPickerImage.height);registerEventHandler(colorPickerCanvas,"click",onColorPickerCanvasClick);registerEventHandler(colorPickerCanvas,"mousemove",onColorPickerCanvasMoveOver);document.body.appendChild(colorPickerCanvas);};onColorPickerClick=function(event){colorPickerSelectedCurrent=event.currentTarget;logMsg(colorPickerSelectedCurrent);colorPickerCanvas.style.display="inline-block";colorPickerCanvas.style.left=event.clientX+"px";colorPickerCanvas.style.top=event.clientY+"px";};onColorPickerCanvasClick=function(event){colorPickerCanvas.style.display="none";manualEvent(colorPickerSelectedCurrent.parentNode,COLORPICKER_CONFIRMEVENT_ID);};onColorPickerCanvasMoveOver=function(event){var pixelData=colorPickerCanvas.getContext('2d').getImageData(event.offsetX,event.offsetY,1,1).data;colorPickerSelectedCurrent.style.backgroundColor="#"+rgbToHex(pixelData[0],pixelData[1],pixelData[2]);manualEvent(colorPickerSelectedCurrent.parentNode,COLORPICKER_CHANGEEVENT_ID);if(pixelData[3]>0){colorPickerCanvas.style.cursor="pointer";}else{colorPickerCanvas.style.cursor="default";}};return{fillHTMLFromOb:fillHTMLFromOb,createButtonFromOb:createButtonFromOb,createSelectFromOb:createSelectFromOb,createInputFromOb:createInputFromOb,createSpinnerFromOb:createSpinnerFromOb,onSpinnerStart:onSpinnerStart,onSpinnerMouseUp:onSpinnerMouseUp,onIncreaseSpinnerMouseDown:onIncreaseSpinnerMouseDown,onDecreaseSpinnerMouseDown:onDecreaseSpinnerMouseDown,doSpinStep:doSpinStep,createRadioFromOb:createRadioFromOb,createCheckboxFromOb:createCheckboxFromOb,addLIsFromOb:addLIsFromOb,createBasicElementFromOb:createBasicElementFromOb,createColorPickerFromOb:createColorPickerFromOb};}());var uk=(uk!==undefined)?uk:{};uk.co=(uk.co!==undefined)?uk.co:{};uk.co.firmgently=(uk.co.firmgently!==undefined)?uk.co.firmgently:{};uk.co.firmgently.DontDillyDally=(function(){"use strict";var
prop,dateDisplayStart,dateDisplaySelected,dateToday,clientNameInput_el,jobNameInput_el,clientSaveBtn_el,jobSaveBtn_el,colPickClientFG_el,colPickClientBG_el,colPickJobFG_el,colPickJobBG_el,dayJumpTimer,doSetup,selectPage,drawPage,clearPage,drawGUIFromAr,eventAutoRepeat,dayJumpAutorepeatStop,createFormFromOb,addTask,removeTask,addClient,removeClientOrJob,addJob,callMethodFromObOnElement,callMethodFromOb,onFormClick,onScroll,drawTimesheets,drawJobsAndClients,drawClientOrJobFromOb,getNextID,newClientCreate,newJobCreate,navClick,todayClick,weekNextClick,weekPrevClick,monthNextClick,monthPrevClick,onClientTyped,onJobTyped,onFormSubmit,onUpdateInput,onIsMoneyTaskChkChange,onSaveBtnClick,onColorChangeConfirm,dataStoragePossible,initData,dataStoreObject,dataRetrieveObject,dataUpdateObject,clientAndJobStyleSheet,createClientOrJobFromOb,createCSSForClientOrJobFromOb,getJobOrClientIDFromElement,updateDataFromWorkItemEl,updateDataFromClientOrJobEl,getFirstVisibleDayElement,newClientFormSave,newJobFormSave,clientInputWasLastEmpty,handleFileSelect,updateColoursFromPickers,updatePickerFromColours,updateLayoutRefs,updateSelected,drawUIWorkItem,removeWorkItem;for(prop in uk.co.firmgently.DDDConsts){this[prop]=uk.co.firmgently.DDDConsts[prop];}
for(prop in uk.co.firmgently.FGUtils){this[prop]=uk.co.firmgently.FGUtils[prop];}
for(prop in uk.co.firmgently.FGHTMLBuild){this[prop]=uk.co.firmgently.FGHTMLBuild[prop];}
dataStoragePossible=function(){if(typeof(Storage)==="undefined"){logMsg(TXT_STORAGE_UNSUPPORTED);}else{return true;}};initData=function(){var item,container;if(!dataRetrieveObject(PREFS_STR)){dataStoreObject(PREFS_STR,{pagetype:PAGETYPE_DEFAULT,timespan:TIMESPAN_DEFAULT,dateFormat:DATETYPE_DEFAULT,totalsToShow:SHOWTOTALS_DEFAULT,minuteIncrements:MINUTEINCREMENTS_DEFAULT});dataStoreObject(CLIENTSTOTAL_STR,0);dataStoreObject(JOBSTOTAL_STR,0);dataStoreObject(CLIENTS_STR,{});for(item in CLIENT_DEFAULTS){createClientOrJobFromOb(CLIENT_DEFAULTS[item],DATATYPE_CLIENT);}
dataStoreObject(JOBS_STR,{});for(item in JOB_DEFAULTS){createClientOrJobFromOb(JOB_DEFAULTS[item],DATATYPE_JOB);}
dataStoreObject(DAYS_STR,{});}else{container=dataRetrieveObject(CLIENTS_STR);for(item in container){createCSSForClientOrJobFromOb(container[item],DATATYPE_CLIENT);}
container=dataRetrieveObject(JOBS_STR);for(item in container){createCSSForClientOrJobFromOb(container[item],DATATYPE_JOB);}}};dataStoreObject=function(category,ob){localStorage.setItem(APP_ID+"_"+category,JSON.stringify(ob));};dataRetrieveObject=function(category){return JSON.parse(localStorage.getItem(APP_ID+"_"+category));};dataUpdateObject=function(category,key,value){var prop,ob=dataRetrieveObject(category);for(prop in ob){if(prop===key){ob[prop]=value;break;}}
dataStoreObject(category,ob);};handleFileSelect=function(event){var file=event.target.files[0],reader=new FileReader();reader.onload=function(event){console.log(event.target.result);};reader.readAsText(file);console.log(file);};onSaveBtnClick=function(event){var obj={},data,el;obj[PREFS_STR]=dataRetrieveObject(PREFS_STR);obj[JOBS_STR]=dataRetrieveObject(JOBS_STR);obj[JOBSTOTAL_STR]=dataRetrieveObject(JOBSTOTAL_STR);obj[CLIENTS_STR]=dataRetrieveObject(CLIENTS_STR);obj[CLIENTSTOTAL_STR]=dataRetrieveObject(CLIENTSTOTAL_STR);obj[DAYS_STR]=dataRetrieveObject(DAYS_STR);data="text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(obj));el=document.createElement("a");el.href="data:"+data;el.download=SAVE_FILENAME+".txt";el.innerHTML="download .txt file of json";document.body.appendChild(el);el.click();document.body.removeChild(el);};doSetup=function(){dateDisplayStart=new Date();dateDisplaySelected=new Date();dateToday=new Date();if(dataStoragePossible()){initData();drawGUIFromAr(GUIDATA_NAVMAIN);if(location.hash){selectPage(decodeURIComponent(location.hash.substring(1)));}else{selectPage(dataRetrieveObject(PREFS_STR).pagetype);}}
registerEventHandler(document.getElementById("file-chooser"),"change",handleFileSelect,false);registerEventHandler(document.getElementById("file-save"),"click",onSaveBtnClick,false);};selectPage=function(pagetype){dataUpdateObject(PREFS_STR,"pagetype",pagetype);location.hash=pagetype;document.body.id="";clearPage();setTimeout(drawPage,1);};clearPage=function(){removeClassname(document.getElementById(LOADINGINDICATOR_ID),"hidden");document.getElementById("main").innerHTML="";};drawPage=function(){document.getElementById("main").appendChild(createElementWithId("h1","pageTitle"));document.getElementById("main").appendChild(createElementWithId("h2","intro"));switch(dataRetrieveObject(PREFS_STR).pagetype){case PAGETYPE_TIMESHEETS:document.body.id=BODYID_TIMESHEETS;fillHTMLFromOb(PAGEDATA_TIMESHEETS);drawGUIFromAr(GUIDATA_TIMESHEETS);break;case PAGETYPE_CONFIG:document.body.id=BODYID_CONFIG;fillHTMLFromOb(PAGEDATA_CONFIG);drawGUIFromAr(GUIDATA_CONFIG);break;case PAGETYPE_JOBSANDCLIENTS:document.body.id=BODYID_JOBSANDCLIENTS;fillHTMLFromOb(PAGEDATA_JOBSANDCLIENTS);drawGUIFromAr(GUIDATA_JOBSANDCLIENTS);break;default:break;}
updateLayoutRefs();addClassname(document.getElementById(LOADINGINDICATOR_ID),"hidden");};drawGUIFromAr=function(ar){var i,ob,el_temp;for(i=0;i<ar.length;i++){ob=ar[i];switch(ob.type){case GUITYPE_BTN:el_temp=createButtonFromOb(ob);if(ob.methodPathStr){registerEventHandler(el_temp,"mousedown",callMethodFromObOnElement);}
break;case GUITYPE_FORM:createFormFromOb(ob);break;case GUITYPE_TEXTINPUT:el_temp=createInputFromOb(ob);if(ob.methodPathStr){registerEventHandler(el_temp,"change",callMethodFromObOnElement);registerEventHandler(el_temp,"keyup",callMethodFromObOnElement);registerEventHandler(el_temp,"paste",callMethodFromObOnElement);registerEventHandler(el_temp,"input",callMethodFromObOnElement);}
break;case GUITYPE_SELECT:el_temp=createSelectFromOb(ob);if(ob.methodPathStr){registerEventHandler(el_temp,"change",callMethodFromObOnElement);}
break;case GUITYPE_RADIOBTN:ob.checkIfMatched=dataRetrieveObject(PREFS_STR)[ob.id];el_temp=createRadioFromOb(ob);if(ob.methodPathStr){registerEventHandler(el_temp,"change",callMethodFromObOnElement);}
break;case GUITYPE_UL:addLIsFromOb(ob);break;case GUITYPE_PARA:case GUITYPE_SECTION:case GUITYPE_COL:case GUITYPE_ROW:createBasicElementFromOb(ob);break;case GUITYPE_COLORPICKER:createColorPickerFromOb(ob);break;case GUITYPE_METHODCALL:callMethodFromOb(ob);break;default:break;}}};createFormFromOb=function(ob){var i,form_el,parent_el=document.getElementById(ob.parent);if(ob.id){form_el=createElementWithId("form",ob.id);}else{form_el=document.createElement("form");}
parent_el.appendChild(form_el);if(ob.class){addClassname(form_el,ob.class);}
if(ob.title){form_el.innerHTML="<h2>"+ob.title+"</h2>";}
if(ob.el_ar){drawGUIFromAr(ob.el_ar);}
if(ob.hidden){form_el.style.display="none";}
form_el.ob=ob;registerEventHandler(form_el,"submit",onFormSubmit);registerEventHandler(form_el,"click",onFormClick);return form_el;};addTask=function(){drawUIWorkItem(this.parentNode);};removeTask=function(){removeWorkItem(this);};getNextID=function(type){var prefix,name,n;if(type===DATATYPE_JOB){n=0+(dataRetrieveObject(JOBSTOTAL_STR))+1;dataStoreObject(JOBSTOTAL_STR,n);prefix=JOB_STR;}else if(type===DATATYPE_CLIENT){n=0+(dataRetrieveObject(CLIENTSTOTAL_STR))+1;dataStoreObject(CLIENTSTOTAL_STR,n);prefix=CLIENT_STR;}
return prefix+n;};createClientOrJobFromOb=function(ob,dataType){var id,ar,n,containerObjectName,input_el;if(dataType===DATATYPE_CLIENT){input_el=document.getElementById(EL_ID_CLIENTNAMEIN);containerObjectName=CLIENTS_STR;}else if(dataType===DATATYPE_JOB){input_el=document.getElementById(EL_ID_JOBNAMEIN);containerObjectName=JOBS_STR;}
id=getNextID(dataType);ob.id=ob.class=id;ar=dataRetrieveObject(containerObjectName);ar[ob.id]=ob;dataStoreObject(containerObjectName,ar);createCSSForClientOrJobFromOb(ob,dataType);};createCSSForClientOrJobFromOb=function(ob,dataType){var selector="."+ob.class+", "+
"."+ob.class+":hover, "+
"."+ob.class+":active",colorPickerFGSelector,colorPickerBGSelector;if(dataType===DATATYPE_CLIENT||dataType===DATATYPE_JOB){addCSSRule(selector,"color",ob.color+" !important");addCSSRule(selector,"background-color",ob.bgcolor+" !important");}else{addCSSRule(selector,"color",ob.color);addCSSRule(selector,"background-color",ob.bgcolor);}
if(dataType===DATATYPE_CLIENT){colorPickerFGSelector="#"+CLIENT_FG_COLPICK;colorPickerBGSelector="#"+CLIENT_BG_COLPICK;}else if(dataType===DATATYPE_JOB){colorPickerFGSelector="#"+JOB_FG_COLPICK;colorPickerBGSelector="#"+JOB_BG_COLPICK;}
addCSSRule(colorPickerFGSelector,"background-color",ob.color);addCSSRule(colorPickerBGSelector,"background-color",ob.bgcolor);};callMethodFromObOnElement=function(event){callMethodFromOb(event.target.ob,event);};callMethodFromOb=function(ob,event){var scope;if(ob.scope){scope=ob.scope;}else if(ob.scopeID){scope=document.getElementById(ob.scopeID);}else{scope=undefined;}
if(event){if(ob.args){ob.args.push(event);}else{ob.args=[event];}}
getFunctionFromString(ob.methodPathStr).apply(scope,ob.args);};onClientTyped=function(){clientSaveBtn_el.disabled=clientNameInput_el.value.isEmpty();};onJobTyped=function(){jobSaveBtn_el.disabled=jobNameInput_el.value.isEmpty();};onColorChangeConfirm=function(event){updateDataFromClientOrJobEl(this);};onScroll=function(){var i,day,rect,days=document.getElementById(TIMESHEETCONTAINER_ID).childNodes;for(i=0;i<days.length;i++){day=days[i];rect=day.getBoundingClientRect();if(rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)){day.style.left="-9999em";}else{day.style.left="0";}}}
drawJobsAndClients=function(){var ul_el,li_el,temp_el,prop,item,item_ar;item_ar=dataRetrieveObject(CLIENTS_STR);ul_el=document.createElement("ul");addClassname(ul_el,CLIENTS_STR);for(prop in item_ar){drawClientOrJobFromOb(prop,item_ar[prop],ul_el,CLIENTS_STR);}
document.getElementById("clientsExistingRow").appendChild(ul_el);item_ar=dataRetrieveObject(JOBS_STR);ul_el=document.createElement("ul");addClassname(ul_el,JOBS_STR);for(prop in item_ar){drawClientOrJobFromOb(prop,item_ar[prop],ul_el,JOBS_STR);}
document.getElementById("jobsExistingRow").appendChild(ul_el);};drawClientOrJobFromOb=function(id,item,ul_el,type_str){var li_el,temp_el,removeMethodPath,addMethodPath;li_el=createElementWithId("li",id);registerEventHandler(li_el,COLORPICKER_CHANGEEVENT_ID,updateColoursFromPickers);registerEventHandler(li_el,COLORPICKER_CONFIRMEVENT_ID,onColorChangeConfirm);ul_el.appendChild(li_el);if(type_str===CLIENTS_STR){addMethodPath="uk.co.firmgently.DontDillyDally.addClient";}else if(type_str===JOBS_STR){addMethodPath="uk.co.firmgently.DontDillyDally.addJob";}
removeMethodPath="uk.co.firmgently.DontDillyDally.removeClientOrJob";temp_el=createButtonFromOb({class:"addTaskBtn",label:"&#xe821;",parent:li_el,methodPathStr:addMethodPath,scopeID:id});registerEventHandler(temp_el,"mousedown",callMethodFromObOnElement);temp_el=createInputFromOb({class:id,parent:li_el,attributes:{"type":"text","value":item.name},methodPathStr:"uk.co.firmgently.DontDillyDally.onUpdateInput",scopeID:id});temp_el.ob.scope=temp_el;registerEventHandler(temp_el,"change",callMethodFromObOnElement);registerEventHandler(temp_el,"keyup",callMethodFromObOnElement);registerEventHandler(temp_el,"paste",callMethodFromObOnElement);registerEventHandler(temp_el,"input",callMethodFromObOnElement);temp_el=createColorPickerFromOb({parent:li_el,class:"color-picker bg",id:"cpbg-"+id,color:item.bgcolor});temp_el=createColorPickerFromOb({parent:li_el,class:"color-picker fg",id:"cpfg-"+id,color:item.color});temp_el=createButtonFromOb({class:"removeTaskBtn",label:"&#xe83d;",parent:li_el,methodPathStr:removeMethodPath,scopeID:id});registerEventHandler(temp_el,"mousedown",callMethodFromObOnElement);};drawTimesheets=function(){var i,j,daysToDraw,weekdayCur,day_str,isToday,significance_str,rowClassname,monthHeader_el,day_el,date_el,dayDataContainer_el,hrs_el,client_el,job_el,ob_temp,dayWorkItems,workItem,weekStartDay=1,parent_el=document.getElementById(TIMESHEETCONTAINER_ID),workingFragment=document.createDocumentFragment(),allWorkItems=dataRetrieveObject(DAYS_STR),dayCur=new Date();switch(dataRetrieveObject(PREFS_STR).timespan){case TIMESPAN_WEEK:weekdayCur=dayCur.getDay();dayCur.setDate(dayCur.getDate()-weekdayCur+weekStartDay);daysToDraw=DAYSINWEEK;break;case TIMESPAN_MONTH:dayCur.setDate(1);daysToDraw=dayCur.monthDays();break;case TIMESPAN_YEAR:dayCur.setMonth(0);dayCur.setDate(1);daysToDraw=DAYSINYEAR;if(dayCur.isLeapYear()){daysToDraw+=1;}
break;default:break;}
for(i=0;i<daysToDraw;i++){significance_str="";day_str=dayCur.getShortISO();rowClassname="day row ";isToday=!Math.round(daysBetween(dayCur,dateToday));day_el=createElementWithId("li",day_str);if(isToday){rowClassname+=CLASS_TODAY+" ";significance_str+="TODAY";}
if(dayCur.getDay()===weekStartDay){rowClassname+="week-start ";significance_str+="week "+dayCur.getWeekNumber();if(dayCur.getWeekNumber()===1&&dayCur.getMonth()===11){significance_str+=" ("+(dayCur.getFullYear()+1)+")";}}
if(dayCur.getDate()===1){rowClassname+="month-start ";monthHeader_el=document.createElement("h4");monthHeader_el.innerHTML=MONTH_NAMES[dayCur.getMonth()];day_el.appendChild(monthHeader_el);}
addClassname(day_el,rowClassname);workingFragment.appendChild(day_el);date_el=document.createElement("p");addClassname(date_el,"date col");if(significance_str!==""){date_el.innerHTML="<em>"+dayCur.getWeekDay(1)+"</em>"+getFormattedDate(dayCur,DATETYPE_DEFAULT.label)+"<span>"+significance_str+"</span>";}else{date_el.innerHTML="<em>"+dayCur.getWeekDay(1)+"</em>"+getFormattedDate(dayCur,DATETYPE_DEFAULT.label);}
dayCur.setDate(dayCur.getDate()+1);day_el.appendChild(date_el);dayDataContainer_el=document.createElement("ul");addClassname(dayDataContainer_el,"day-data col");day_el.appendChild(dayDataContainer_el);dayWorkItems=allWorkItems[day_str];if(dayWorkItems===undefined||isEmpty(dayWorkItems)){drawUIWorkItem(dayDataContainer_el);}else{for(workItem in dayWorkItems){drawUIWorkItem(dayDataContainer_el,workItem,dayWorkItems[workItem]);}}}
parent_el.appendChild(workingFragment);};drawUIWorkItem=function(dayDataContainer_el,itemID,itemData_ob){var hrs_el,money_el,ob_temp,el_temp,item_el,wrappedCheckbox_el,numberValue_ar,day_el=dayDataContainer_el.parentNode;if(itemID===undefined){itemID=getGUID();}
item_el=createElementWithId("li",itemID);dayDataContainer_el.insertBefore(item_el,dayDataContainer_el.firstChild);el_temp=createButtonFromOb({class:"addTaskBtn",label:"&#xe821;",parent:item_el,methodPathStr:"uk.co.firmgently.DontDillyDally.addTask",scopeID:itemID});registerEventHandler(el_temp,"mousedown",callMethodFromObOnElement);el_temp=createSelectFromOb({contentType:CONTENTTYPE_CLIENTS,placeholderText:CLIENT_SELECT_PLACEHOLDER,options:dataRetrieveObject(CLIENTS_STR),parent:item_el,methodPathStr:"uk.co.firmgently.DontDillyDally.updateSelected",});el_temp.ob.scope=el_temp;registerEventHandler(el_temp,"change",callMethodFromObOnElement);if(itemData_ob&&itemData_ob[DATAINDICES.clientID]&&itemData_ob[DATAINDICES.clientID].length>0){changeSelectByOption(el_temp,itemData_ob[DATAINDICES.clientID]);manualEvent(el_temp,"change");}
el_temp=createSelectFromOb({contentType:CONTENTTYPE_JOBS,placeholderText:JOB_SELECT_PLACEHOLDER,options:dataRetrieveObject(JOBS_STR),parent:item_el,methodPathStr:"uk.co.firmgently.DontDillyDally.updateSelected"});el_temp.ob.scope=el_temp;registerEventHandler(el_temp,"change",callMethodFromObOnElement);if(itemData_ob&&itemData_ob[DATAINDICES.jobID]&&itemData_ob[DATAINDICES.jobID].length>0){changeSelectByOption(el_temp,itemData_ob[DATAINDICES.jobID]);manualEvent(el_temp,"change");}
el_temp=createCheckboxFromOb({class:"ios-switch isMoneyTaskChk",label:" ",wrapLabel:true,addDivToLabel:true,parent:item_el,checked:false,methodPathStr:"uk.co.firmgently.DontDillyDally.onIsMoneyTaskChkChange",scopeID:itemID});registerEventHandler(el_temp,"change",callMethodFromObOnElement);if(itemData_ob&&itemData_ob[DATAINDICES.itemType]===ITEMTYPE_MONEY){el_temp.checked=true;if(itemData_ob&&itemData_ob[DATAINDICES.numberValue]){numberValue_ar=itemData_ob[DATAINDICES.numberValue].split(SEPARATOR_CASH);}
addClassname(item_el,"money");}else{if(itemData_ob&&itemData_ob[DATAINDICES.numberValue]){numberValue_ar=itemData_ob[DATAINDICES.numberValue].split(SEPARATOR_TIME);}
addClassname(item_el,"hrs");}
if(itemData_ob&&itemData_ob[DATAINDICES.itemType]===ITEMTYPE_TIME){ob_temp={min:0,max:23,step:1,wrapNum:true,pad:"00"};}else{ob_temp={min:-999999999,max:999999999,step:1,pad:"    "};}
el_temp=createSpinnerFromOb({class:"unitBig",parent:item_el,attributes:ob_temp,methodPathStr:"uk.co.firmgently.DontDillyDally.onUpdateInput",scopeID:itemID});el_temp.ob.scope=el_temp;registerEventHandler(el_temp,"change",callMethodFromObOnElement);registerEventHandler(el_temp,"keyup",callMethodFromObOnElement);registerEventHandler(el_temp,"paste",callMethodFromObOnElement);registerEventHandler(el_temp,"input",callMethodFromObOnElement);if(itemData_ob&&itemData_ob[DATAINDICES.numberValue]){el_temp.value=numberValue_ar[0];if(parseInt(numberValue_ar[0])<0){addClassname(el_temp.parentNode.parentNode,"negative");}
manualEvent(el_temp,"change");}
if(itemData_ob&&itemData_ob[DATAINDICES.itemType]===ITEMTYPE_TIME){ob_temp={min:0,max:59,wrapNum:true,pad:"00"};switch(dataRetrieveObject(PREFS_STR).minuteIncrements){case MINUTEINCREMENTS_15:ob_temp.step=15;break;case MINUTEINCREMENTS_30:ob_temp.step=30;break;case MINUTEINCREMENTS_1:default:ob_temp.step=1;break;}}else{ob_temp={min:0,max:99,step:1,wrapNum:true,pad:"00"};}
el_temp=createSpinnerFromOb({class:"unitSmall",parent:item_el,attributes:ob_temp,methodPathStr:"uk.co.firmgently.DontDillyDally.onUpdateInput",scopeID:itemID});el_temp.ob.scope=el_temp;registerEventHandler(el_temp,"change",callMethodFromObOnElement);registerEventHandler(el_temp,"keyup",callMethodFromObOnElement);registerEventHandler(el_temp,"paste",callMethodFromObOnElement);registerEventHandler(el_temp,"input",callMethodFromObOnElement);if(itemData_ob&&itemData_ob[DATAINDICES.numberValue]){el_temp.value=numberValue_ar[1];manualEvent(el_temp,"change");}
el_temp=createInputFromOb({class:"notes",parent:item_el,attributes:{"type":"text","placeholder":JOBNOTES_PLACEHOLDER},methodPathStr:"uk.co.firmgently.DontDillyDally.onUpdateInput",scopeID:itemID});el_temp.ob.scope=el_temp;registerEventHandler(el_temp,"change",callMethodFromObOnElement);registerEventHandler(el_temp,"keyup",callMethodFromObOnElement);registerEventHandler(el_temp,"paste",callMethodFromObOnElement);registerEventHandler(el_temp,"input",callMethodFromObOnElement);if(itemData_ob&&itemData_ob[DATAINDICES.notes]){el_temp.value=itemData_ob[DATAINDICES.notes];}
el_temp=createButtonFromOb({class:"removeTaskBtn",label:"&#xe83d;",parent:item_el,methodPathStr:"uk.co.firmgently.DontDillyDally.removeTask",scopeID:itemID});registerEventHandler(el_temp,"mousedown",callMethodFromObOnElement);if(itemData_ob&&itemData_ob[DATAINDICES.itemType]===ITEMTYPE_MONEY){onIsMoneyTaskChkChange.call(item_el);}};removeClientOrJob=function(){var data_ob,type_str;if(this.id.indexOf(CLIENT_STR)!==-1){type_str=CLIENTS_STR;}else if(this.id.indexOf(JOB_STR)!==-1){type_str=JOBS_STR;}
data_ob=dataRetrieveObject(type_str);delete data_ob[this.id];this.parentNode.removeChild(this);dataStoreObject(type_str,data_ob);};removeWorkItem=function(item_el){var days_ar=dataRetrieveObject(DAYS_STR),day_ob=days_ar[item_el.parentNode.parentNode.id];delete day_ob[item_el.id];item_el.parentNode.removeChild(item_el);dataStoreObject(DAYS_STR,days_ar);};updateColoursFromPickers=function(event){var i,inputNodes,currentNode,fg_el,bg_el,textInput_el;inputNodes=this.getElementsByTagName("INPUT");for(i=0;i<inputNodes.length;i++){currentNode=inputNodes[i];if(currentNode.type==="text"){textInput_el=currentNode;}else if(currentNode.className.indexOf("color-picker")!==-1){if(currentNode.className.indexOf("bg")!==-1){bg_el=currentNode.nextSibling;}else if(currentNode.className.indexOf("fg")!==-1){fg_el=currentNode.nextSibling;}}}
textInput_el.className="";textInput_el.style.color=getStyle(fg_el,"background-color");textInput_el.style.backgroundColor=getStyle(bg_el,"background-color");};updatePickerFromColours=function(type,fgCol,bgCol){if(type===CLIENTS_STR){colPickClientBG_el.style.backgroundColor=bgCol;colPickClientFG_el.style.backgroundColor=fgCol;}else if(type===JOBS_STR){colPickJobBG_el.style.backgroundColor=bgCol;colPickJobFG_el.style.backgroundColor=fgCol;}};updateLayoutRefs=function(){clientNameInput_el=document.getElementById(EL_ID_CLIENTNAMEIN);clientSaveBtn_el=document.getElementById(EL_ID_CLIENTSAVEBTN);colPickClientFG_el=document.getElementById(CLIENT_FG_COLPICK);colPickClientBG_el=document.getElementById(CLIENT_BG_COLPICK);jobNameInput_el=document.getElementById(EL_ID_JOBNAMEIN);jobSaveBtn_el=document.getElementById(EL_ID_JOBSAVEBTN);colPickJobFG_el=document.getElementById(JOB_FG_COLPICK);colPickJobBG_el=document.getElementById(JOB_BG_COLPICK);};onFormClick=function(e){var form=e.target.form;if(form&&form.id){switch(form.id){case "configForm":dataUpdateObject(PREFS_STR,"timespan",form.timespan.value);dataUpdateObject(PREFS_STR,"dateFormat",form.dateFormat.value);dataUpdateObject(PREFS_STR,"totalsToShow",form.totalsToShow.value);dataUpdateObject(PREFS_STR,"minuteIncrements",form.minuteIncrements.value);break;default:break;}}};onFormSubmit=function(e){stopPropagation(e);};onUpdateInput=function(event){switch(dataRetrieveObject(PREFS_STR).pagetype){case PAGETYPE_TIMESHEETS:if(document.body.contains(this)){if(this.className.indexOf("notes")!==-1){updateDataFromWorkItemEl(this.parentNode.parentNode);}else{if(isNaN(parseInt(this.value))){this.value=0;}
if(this.className.indexOf("unitBig")!==-1){if(parseInt(this.value)<0){addClassname(this.parentNode.parentNode,"negative");}else{removeClassname(this.parentNode.parentNode,"negative");}}
updateDataFromWorkItemEl(this.parentNode.parentNode);this.value=padString(this.value,this.spin_ob.pad);}}
break;case PAGETYPE_CONFIG:break;case PAGETYPE_JOBSANDCLIENTS:break;default:break;}};onIsMoneyTaskChkChange=function(){var checkbox=this.getElementsByClassName("isMoneyTaskChk")[0],notesInput=this.getElementsByClassName("notes")[0];if(checkbox.checked){addClassname(this,"money");removeClassname(this,"hrs");notesInput.placeholder=MONEYNOTES_PLACEHOLDER;}else{addClassname(this,"hrs");removeClassname(this,"money");notesInput.placeholder=JOBNOTES_PLACEHOLDER;}
if(document.body.contains(this)){updateDataFromWorkItemEl(this);}};newClientCreate=function(){var fgCol=getRandomHexColor("dark"),bgCol=getRandomHexColor("light");document.getElementById(EL_ID_CLIENTNAMEIN).value=getNextID(DATATYPE_CLIENT);addCSSRule("#"+CLIENT_FG_COLPICK,"background-color",fgCol);addCSSRule("#"+CLIENT_BG_COLPICK,"background-color",bgCol);addCSSRule("#"+EL_ID_CLIENTNAMEIN,"color",fgCol);addCSSRule("#"+EL_ID_CLIENTNAMEIN,"background-color",bgCol);clientSaveBtn_el.disabled=false;updateLayoutRefs();};newJobCreate=function(){var fgCol=getRandomHexColor("light"),bgCol=getRandomHexColor("dark");document.getElementById(EL_ID_JOBNAMEIN).value=getNextID(DATATYPE_JOB);addCSSRule("#"+JOB_FG_COLPICK,"background-color",fgCol);addCSSRule("#"+JOB_BG_COLPICK,"background-color",bgCol);addCSSRule("#"+EL_ID_JOBNAMEIN,"color",fgCol);addCSSRule("#"+EL_ID_JOBNAMEIN,"background-color",bgCol);jobSaveBtn_el.disabled=false;updateLayoutRefs();};newClientFormSave=function(){createClientOrJobFromOb({name:document.getElementById(EL_ID_CLIENTNAMEIN).value,color:getStyle(colPickClientFG_el,"background-color"),bgcolor:getStyle(colPickClientBG_el,"background-color")},DATATYPE_CLIENT);updateSelectOptionList(document.getElementById("selectClient"),dataRetrieveObject(CLIENTS_STR));};newJobFormSave=function(){createClientOrJobFromOb({name:document.getElementById(EL_ID_JOBNAMEIN).value,color:getStyle(colPickJobFG_el,"background-color"),bgcolor:getStyle(colPickJobBG_el,"background-color")},DATATYPE_JOB);updateSelectOptionList(document.getElementById("selectJob"),dataRetrieveObject(JOBS_STR));};navClick=function(e){selectPage(arguments[0]);};weekPrevClick=function(e){var i,day,scrollTop=document.getElementById("main").scrollTop,days=document.getElementsByClassName("week-start");for(i=days.length-1;i>=0;i--){day=days[i];if(day.offsetTop<scrollTop){day.scrollIntoView();break;}}
eventAutoRepeat(e.target,e.type);registerEventHandler(e.target,"mouseup",dayJumpAutorepeatStop);registerEventHandler(e.target,"mouseout",dayJumpAutorepeatStop);};weekNextClick=function(e){var i,day,scrollTop=document.getElementById("main").scrollTop,days=document.getElementsByClassName("week-start");for(i=0;i<days.length;i++){day=days[i];if(day.offsetTop>scrollTop){day.scrollIntoView();break;}}
eventAutoRepeat(e.target,e.type);registerEventHandler(e.target,"mouseup",dayJumpAutorepeatStop);registerEventHandler(e.target,"mouseout",dayJumpAutorepeatStop);};monthPrevClick=function(e){var i,day,scrollTop=document.getElementById("main").scrollTop,days=document.getElementsByClassName("month-start");for(i=days.length-1;i>=0;i--){day=days[i];if(day.offsetTop<scrollTop){day.scrollIntoView();break;}}
eventAutoRepeat(e.target,e.type);registerEventHandler(e.target,"mouseup",dayJumpAutorepeatStop);registerEventHandler(e.target,"mouseout",dayJumpAutorepeatStop);};monthNextClick=function(e){var i,day,scrollTop=document.getElementById("main").scrollTop,days=document.getElementsByClassName("month-start");for(i=0;i<days.length;i++){day=days[i];if(day.offsetTop>scrollTop){day.scrollIntoView();break;}}
eventAutoRepeat(e.target,e.type);registerEventHandler(e.target,"mouseup",dayJumpAutorepeatStop);registerEventHandler(e.target,"mouseout",dayJumpAutorepeatStop);};todayClick=function(e){document.getElementsByClassName(CLASS_TODAY)[0].scrollIntoView();};eventAutoRepeat=function(el,eventType){clearTimeout(dayJumpTimer);dayJumpTimer=setTimeout(function(){manualEvent(el,eventType);},AUTOREPEAT_RATE);};dayJumpAutorepeatStop=function(){clearTimeout(dayJumpTimer);};updateSelected=function(){var pageType=dataRetrieveObject(PREFS_STR).pagetype,option_selector=this.value;switch(pageType){case PAGETYPE_TIMESHEETS:case PAGETYPE_JOBSANDCLIENTS:if(this.className.indexOf(CLASS_CLIENTSELECT)!==-1){this.className=CLASS_CLIENTSELECT+" "+option_selector;}else if(this.className.indexOf(CLASS_JOBSELECT)!==-1){this.className=CLASS_JOBSELECT+" "+option_selector;}
break;case PAGETYPE_CONFIG:break;default:break;}
if(pageType===PAGETYPE_TIMESHEETS){if(document.body.contains(this)){updateDataFromWorkItemEl(this.parentNode);}}};updateDataFromWorkItemEl=function(el){var days_ar,day_ob,workItem_ar,isMoneyTaskChk_el,unitBigInput_el,unitSmallInput_el,clientSelect_el,jobSelect_el,notesInput_el,pageType=dataRetrieveObject(PREFS_STR).pagetype,day_el=el.parentNode.parentNode,day_str=day_el.id;isMoneyTaskChk_el=el.getElementsByClassName("isMoneyTaskChk")[0];unitBigInput_el=el.getElementsByClassName("unitBig")[0];unitSmallInput_el=el.getElementsByClassName("unitSmall")[0];clientSelect_el=el.getElementsByClassName(CLASS_CLIENTSELECT)[0];jobSelect_el=el.getElementsByClassName(CLASS_JOBSELECT)[0];notesInput_el=el.getElementsByClassName("notes")[0];days_ar=dataRetrieveObject(DAYS_STR);day_ob=days_ar[day_str];if(day_ob===undefined){day_ob={};}
workItem_ar=[];if(isMoneyTaskChk_el.checked){workItem_ar[DATAINDICES.itemType]=ITEMTYPE_MONEY;workItem_ar[DATAINDICES.numberValue]=unitBigInput_el.value+SEPARATOR_CASH+unitSmallInput_el.value;}else{workItem_ar[DATAINDICES.itemType]=ITEMTYPE_TIME;workItem_ar[DATAINDICES.numberValue]=unitBigInput_el.value+SEPARATOR_TIME+unitSmallInput_el.value;}
workItem_ar[DATAINDICES.clientID]=getJobOrClientIDFromElement(clientSelect_el);workItem_ar[DATAINDICES.jobID]=getJobOrClientIDFromElement(jobSelect_el);workItem_ar[DATAINDICES.notes]=notesInput_el.value;day_ob[el.id]=workItem_ar;days_ar[day_str]=day_ob;dataStoreObject(DAYS_STR,days_ar);};updateDataFromClientOrJobEl=function(el){var i,inputNodes,currentNode,fg_el,bg_el,textInput_el,items_ob,itemType,update_ob;inputNodes=el.getElementsByTagName("INPUT");for(i=0;i<inputNodes.length;i++){currentNode=inputNodes[i];if(currentNode.type==="text"){textInput_el=currentNode;}else if(currentNode.className.indexOf("color-picker")!==-1){if(currentNode.className.indexOf("bg")!==-1){bg_el=currentNode.nextSibling;}else if(currentNode.className.indexOf("fg")!==-1){fg_el=currentNode.nextSibling;}}}
if(el.id.indexOf(CLIENT_STR)!==-1){itemType=CLIENTS_STR;}else if(el.id.indexOf(JOB_STR)!==-1){itemType=JOBS_STR;}
items_ob=dataRetrieveObject(itemType);update_ob={id:el.id,class:el.id,name:textInput_el.value,color:getStyle(fg_el,"background-color"),bgcolor:getStyle(bg_el,"background-color")}
logMsg(el.id);logMsg(el.className);logMsg(itemType);logMsg(items_ob);logMsg(update_ob);items_ob[el.id]=update_ob;dataStoreObject(itemType,items_ob);};getJobOrClientIDFromElement=function(el){var i,id,curClass,class_ar;if(el){class_ar=el.className.split(" ");for(i=0;i<class_ar.length;i++){curClass=class_ar[i];if(curClass!==CLASS_JOBSELECT&&curClass!==CLASS_CLIENTSELECT){return curClass;}}}};getFirstVisibleDayElement=function(){var i,day,scrollTop=document.getElementById("main").scrollTop,days=document.getElementById(TIMESHEETCONTAINER_ID).childNodes;for(i=0;i<days.length;i++){day=days[i];if(day.offsetTop>scrollTop){return day;}}};doSetup();return{drawTimesheets:drawTimesheets,drawJobsAndClients:drawJobsAndClients,addTask:addTask,removeTask:removeTask,addJob:addJob,removeClientOrJob:removeClientOrJob,addClient:addClient,navClick:navClick,todayClick:todayClick,weekNextClick:weekNextClick,weekPrevClick:weekPrevClick,monthNextClick:monthNextClick,monthPrevClick:monthPrevClick,newClientCreate:newClientCreate,newJobCreate:newJobCreate,newClientFormSave:newClientFormSave,newJobFormSave:newJobFormSave,updateSelected:updateSelected,onUpdateInput:onUpdateInput,onIsMoneyTaskChkChange:onIsMoneyTaskChkChange,onClientTyped:onClientTyped};}).call(this);